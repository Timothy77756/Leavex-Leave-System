{% extends "Application/base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="bg-dark text-white p-4 rounded shadow-sm">
    <h2 class="text-center mb-4">Welcome, <span class="text-info">{{ user.full_name }}</span></h2>
    <p class="text-center">Department: <span class="text-warning">{{ department }}</span></p>
<h2>Leave Progress</h2>

  <div id="progress-container">
    <div id="progress-text" class="progress-text"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/progressbar.js"></script>
  <script>
    const maxAllowed = 60;
    const totalTaken = 15;
    const percent = totalTaken / maxAllowed;

    // Create circular progress
    const bar = new ProgressBar.Circle('#progress-container', {
      color: '#e74c3c',
      strokeWidth: 10,
      trailColor: '#ecf0f1',
      trailWidth: 5,
      easing: 'easeInOut',
      duration: 1400,
      step: function(state, circle) {
        // You can change the animation or color here if needed
      }
    });

    // Animate and set text
    bar.animate(percent, {
      duration: 1000
    }, function () {
      document.getElementById('progress-text').textContent = `${totalTaken}/${maxAllowed}`;
    });
  </script>
    <!-- My Leave Requests -->
    <div class="mt-5">
      <h4 class="text-light">üìå My Leave Requests</h4>
    <button style='width:100px;height:55px;background-color:blue;color:white;'><a href="{% url 'reliever_requests' %}">Check leave requests</a></button>
      {% if my_leaves %}
        <ul class="list-group mb-4">
          {% for leave in my_leaves %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ leave.reason }}</strong><br>
                <small class="text-muted">{{ leave.start_date }} ‚Üí {{ leave.end_date }}</small>
              </div>
              <span class="badge {% if leave.final_status == 'Approved' %}bg-success{% elif leave.final_status == 'Rejected' %}bg-danger{% else %}bg-warning text-dark{% endif %} p-2 rounded">
                {{ leave.final_status }}
              </span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="alert alert-info">You have no leave requests yet.</div>
      {% endif %}
    </div>

    <!-- Currently Chosen as Reliever -->
    <div class="mt-5">
      <h4 class="text-light">üßç Currently Chosen as Reliever</h4>
      {% if reliever_for %}
        <ul class="list-group mb-4">
          {% for leave in reliever_for %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ leave.applicant.full_name }}</strong><br>
                <small class="text-muted">{{ leave.start_date }} ‚Üí {{ leave.end_date }}</small>
              </div>
              <span class="badge bg-secondary p-2 rounded">Reliever</span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="alert alert-warning">You are not assigned as a reliever currently.</div>
      {% endif %}
    </div>

    <!-- In Progress -->
    <div class="mt-5">
      <h4 class="text-light">‚è≥ In Progress</h4>
      {% if in_progress %}
        <ul class="list-group mb-5">
          {% for leave in in_progress %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ leave.reason }}</strong>
              </div>
              <span class="badge {% if leave.final_status == 'Approved' %}bg-success{% elif leave.final_status == 'Rejected' %}bg-danger{% else %}bg-warning text-dark{% endif %} p-2 rounded">
                {{ leave.final_status }}
              </span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="alert alert-secondary">No in-progress leave requests found.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
