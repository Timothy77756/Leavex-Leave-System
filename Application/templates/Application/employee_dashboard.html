{% extends "Application/base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="bg-dark text-white p-4 rounded shadow-sm">
    <h2 class="text-center mb-4">Welcome, <span class="text-info">{{ user.full_name }}</span></h2>
    <p class="text-center">Department: <span class="text-warning">{{ department }}</span></p>

    <!-- Leave Balance Donut Charts -->
    <h2 class="text-center mt-4">Leave Balances</h2>
    <div class="row text-center" style="margin-bottom: 30px;">
      <div class="col-md-3 col-6 mb-4">
        <canvas id="sickLeaveChart"></canvas>
        <p class="mt-2">Sick Leave</p>
      </div>
      <div class="col-md-3 col-6 mb-4">
        <canvas id="privilegedLeaveChart"></canvas>
        <p class="mt-2">Privileged Leave</p>
      </div>
      <div class="col-md-3 col-6 mb-4">
        <canvas id="floaterHolidayChart"></canvas>
        <p class="mt-2">Floater Holiday</p>
      </div>
      <div class="col-md-3 col-6 mb-4">
        <canvas id="casualLeaveChart"></canvas>
        <p class="mt-2">Casual Leave</p>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      function createDonutChart(id, used, total, color) {
        new Chart(document.getElementById(id), {
          type: 'doughnut',
          data: {
            labels: ['Used', 'Remaining'],
            datasets: [{
              data: [used, total - used],
              backgroundColor: [color, '#e0e0e0']
            }]
          },
          options: {
            cutout: '70%',
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.label + ': ' + context.formattedValue + ' days';
                  }
                }
              }
            }
          }
        });
      }

      createDonutChart('sickLeaveChart', {{ leave_balances.sick_leave|default:0 }}, 10, '#ff6384');
      createDonutChart('privilegedLeaveChart', {{ leave_balances.privileged_leave|default:0 }}, 10, '#36a2eb');
      createDonutChart('floaterHolidayChart', {{ leave_balances.floater_holiday|default:0 }}, 5, '#ffcd56');
      createDonutChart('casualLeaveChart', {{ leave_balances.casual_leave|default:0 }}, 5, '#4bc0c0');
    </script>

    <!-- My Leave Requests -->
    <div class="mt-5">
      <h4 class="text-light">üìå My Leave Requests</h4>
      <button style='width:100px;height:55px;background-color:blue;color:white;'>
        <a href="{% url 'reliever_requests' %}" style="color:white;text-decoration:none;">Check leave requests</a>
      </button>
      {% if my_leaves %}
        <ul class="list-group mb-4">
          {% for leave in my_leaves %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ leave.reason }}</strong><br>
                <small class="text-muted">{{ leave.start_date }} ‚Üí {{ leave.end_date }}</small>
              </div>
              <span class="badge {% if leave.final_status == 'Approved' %}bg-success{% elif leave.final_status == 'Rejected' %}bg-danger{% else %}bg-warning text-dark{% endif %} p-2 rounded">
                {{ leave.final_status }}
              </span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="alert alert-info">You have no leave requests yet.</div>
      {% endif %}
    </div>

    <!-- Currently Chosen as Reliever -->
    <div class="mt-5">
      <h4 class="text-light">üßç Currently Chosen as Reliever</h4>
      {% if reliever_for %}
        <ul class="list-group mb-4">
          {% for leave in reliever_for %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ leave.applicant.full_name }}</strong><br>
                <small class="text-muted">{{ leave.start_date }} ‚Üí {{ leave.end_date }}</small>
              </div>
              <span class="badge bg-secondary p-2 rounded">Reliever</span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="alert alert-warning">You are not assigned as a reliever currently.</div>
      {% endif %}
    </div>

    <!-- In Progress -->
    <div class="mt-5">
      <h4 class="text-light">‚è≥ In Progress</h4>
      {% if in_progress %}
        <ul class="list-group mb-5">
          {% for leave in in_progress %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ leave.reason }}</strong>
              </div>
              <span class="badge {% if leave.final_status == 'Approved' %}bg-success{% elif leave.final_status == 'Rejected' %}bg-danger{% else %}bg-warning text-dark{% endif %} p-2 rounded">
                {{ leave.final_status }}
              </span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="alert alert-secondary">No in-progress leave requests found.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
