{% extends "Application/base.html" %}
{% block title %}HOD Dashboard{% endblock %}
<script src="https://cdn.tailwindcss.com"></script>
{% block content %}
<div class="container mx-auto px-4 py-6">
  <div class="bg-white  p-6 mb-6">
    <h2 class="text-2xl font-bold mb-2">👨‍💼 HOD Dashboard</h2>
    <p class="text-gray-600">Department: <span class="font-semibold text-blue-700">{{ department }}</span></p>
    <p class="text-gray-600">Total Employees: <span class="font-semibold">{{ total_employees }}</span></p>
  </div>

  <!-- Leave Summary -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-blue-100 text-blue-800 p-4 ">
      <p class="text-sm font-medium">Pending Requests</p>
      <h3 class="text-2xl font-bold">{{ pending_leaves }}</h3>
    </div>
    <div class="bg-green-100 text-green-800 p-4 ">
      <p class="text-sm font-medium">Approved</p>
      <h3 class="text-2xl font-bold">{{ approved_leaves }}</h3>
    </div>
    <div class="bg-red-100 text-red-800 p-4 ">
      <p class="text-sm font-medium">Rejected</p>
      <h3 class="text-2xl font-bold">{{ rejected_leaves }}</h3>
    </div>
    <div class="bg-yellow-100 text-yellow-800 p-4 ">
      <p class="text-sm font-medium">Leaves This Month</p>
      <h3 class="text-2xl font-bold">{{ leaves_this_month }}</h3>
    </div>
  </div>

  <!-- Leave Requests Table -->
  <div class="bg-white  p-6 mb-6">
    <h3 class="text-xl font-semibold mb-4">📝 Department Leave Requests</h3>
    {% if leave_requests %}
    <div class="overflow-x-auto">
      <table class="table-auto w-full text-left border-collapse">
        <thead>
          <tr class="bg-gray-100 text-sm text-gray-600">
            <th class="p-2">Employee</th>
            <th class="p-2">Type</th>
            <th class="p-2">From</th>
            <th class="p-2">To</th>
            <th class="p-2">Status</th>
<th class="p-2">Action</th>     
     </tr>
        </thead>
        <tbody>
          {% for leave in leave_requests %}
          <tr class="border-t">
            <td class="p-2">{{ leave.applicant.full_name }}</td>
            <td class="p-2">{{ leave.leave_type }}</td>
            <td class="p-2">{{ leave.start_date }}</td>
            <td class="p-2">{{ leave.end_date }}</td>
            <td class="p-2">
              {% if leave.final_status == 'pending' %}
                <span class="text-yellow-600 font-semibold">Pending</span>
              {% elif leave.final_status == 'approved' %}
                <span class="text-green-600 font-semibold">Approved</span>
              {% else %}
                <span class="text-red-600 font-semibold">Rejected</span>
              {% endif %}
            </td>
<td>
<!-- Approve and Reject buttons inside a form -->
<form method="POST" action="{% url 'hod_approvals' %}" class="d-inline">
    {% csrf_token %}

    <input type="hidden" name="leave_id" value="{{ leave.id }}">
    <button type="submit" name="action" value="approve" class="btn btn-success btn-sm shadow rounded-pill px-4 me-2">
        <i class="bi bi-check-circle-fill"></i> Approve
    </button>
    <button type="submit" name="action" value="reject" class="btn btn-danger btn-sm shadow rounded-pill px-4">
        <i class="bi bi-x-circle-fill"></i> Reject
    </button>
</form>
</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>


    </div>
    {% else %}
    <p class="text-gray-500">No leave requests yet.</p>
    {% endif %}
  </div>

  <!-- Employees under HOD -->
  <div class="bg-white  p-6">
    <h3 class="text-xl font-semibold mb-4">👥 Employees in {{ department.name|default:"Department" }}</h3>
    {% if employees %}
    <ul class="space-y-2">
      {% for emp in employees %}
      <li class="bg-gray-50 px-4 py-2  flex justify-between items-center">
        <span class="text-gray-800 font-medium">{{ emp.full_name }}</span>
        <span class="text-sm text-gray-500">{{ emp.position }}</span>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-gray-500">No employees found under your department.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
